<!-- Jurassic World -->
<html>
<head>
<!--
 - - - - -
Scrollable list based off:
http://stackoverflow.com/questions/21998679/css-how-to-make-scrollable-list

CORS
https://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/
-->
<meta http-equiv="Content-Type" content="text/html;utf-8"> 

<!--
///////////////////////////////////////////////////////////////////
Plastic CSS
-->
<style>
 nav ul{height:215px; width:90%;}
 nav ul{overflow:hidden; overflow-y:scroll;}
 nav ul{list-style-type:none;}
 img.map, map area {
  outline: none;
 }
</style>

<!--
///////////////////////////////////////////////////////////////////
Plastic JavaScript
-->

<script type="text/javascript">

///////////////////////////////////////////////////////////////////
//
// Translation menu and handlers: see more, offer another, edit, delete
// The history, lock links direct to the developer wiki - reader can 
// implement if they want: my purpose is not full-feature implementation here.
//
///////////////////////////////////////////////////////////////////

function trnPreferAnother($index) {
 $status = sessionStorage.getItem($ls + '.result');
 if ($status != 200) {
  // if we're showing undefined, then there is no "see more" to look at
  // and the user would need to change the lang(s) and refresh to see more.
  $choices = "No more translations found";
 } else {
  // if we're showing defined by contrast the representation will be storing
  // a link to the all preferable resource (visit_link/langs/all)
  $res = sessionStorage.getItem('csi18n_seemore.representations');
  $json_arr = JSON.parse($res);

  $json_arr.csi18n_xlate_resources = $json_arr.csi18n_xlate_resources.slice($index, $index + 1);
  $res = JSON.stringify($json_arr);

  $url = sessionStorage.getItem('csi18n_seemore.per_lang_pref');

  if (XMLHttpRequest) {
    var request = new XMLHttpRequest();
    if("withCredentials" in request) {
     // Firefox 3.5 and Safari 4
     request.open('PUT', $url, true);
     request.setRequestHeader("Authorization", "Basic dGVzdDA1OnRlc3Q=");
     request.setRequestHeader("X-APIKey", "e3c12c03cf320b243977d6ac389805de");
     request.setRequestHeader("Content-Type", "application/json;v=1.0");
     request.onload = preferanother_handler;
     request.send($res);
    }
  }
 }
}

function trnSeeMore($ls) {
 sessionStorage.setItem('csi18n_seemore.representations', '');
 $status = sessionStorage.getItem($ls + '.result');
 if ($status != 200) {
  // if we're showing undefined, then there is no "see more" to look at
  // and the user would need to change the lang(s) and refresh to see more.
  $unsafe_choice = "No more translations found";
  var d = document.getElementById("trn_menu");
  d.style.position = "fixed";
  d.style.fontFamily = "sans";
  d.style.right = "0px";
  d.style.top = "240px";
  d.style.zIndex = "101";
  d.style.backgroundColor = "#AADDDD";
  d.style.textAlign = "right";
  d.style.fontSize = "20px";

  $safe_choices = "See more<hr>" + escapeHtml($unsafe_choice);
  d.innerHTML = $safe_choices;
  d.style.display = "";

 } else {
  // if we're showing defined by contrast the representation will be storing
  // a link to the all preferable resource (visit_link/langs/all)
  $res = sessionStorage.getItem($ls + '.representation');
  $json = JSON.parse($res);
  $url = $json.csi18n_all_preferable;

  if (XMLHttpRequest) {
    var request = new XMLHttpRequest();
    if("withCredentials" in request) {
     // Firefox 3.5 and Safari 4
     $lang = localStorage.getItem('csi18n_lang');
     if ($lang == null) {
      $lang = window.navigator.language;
     }
     request.open('GET', $url, true);
     request.setRequestHeader("Authorization", "Basic dGVzdDA1OnRlc3Q=");
     request.setRequestHeader("X-APIKey", "e3c12c03cf320b243977d6ac389805de");
     request.setRequestHeader("Accept", "application/json");
     request.responseType = "json";
     request.onload = seemore_handler;
     request.send();
    }
  }
 }
}

function trnOptions($ls) {
 var $tlink = sessionStorage.getItem($ls + '.tlink');

 var d = document.getElementById("trn_menu");
 d.style.position = "fixed";
 d.style.fontFamily = "sans";
 d.style.right = "0px";
 d.style.top = "240px";
 d.style.width = "401px";
 d.style.height = "240px";
 d.style.zIndex = "100";
 d.style.backgroundColor = "#AADDDD";
 d.style.textAlign = "right";
 d.style.fontSize = "20px";
 d.innerHTML =  "Options<hr>" +
 "<input type='button' value='Options' style='font-size:21px' onClick='javascript:sendOptions(\"" + $ls + "\")'>";
 d.style.display = "";
}

function trnHead($ls) {
 var $tlink = sessionStorage.getItem($ls + '.tlink');

 var d = document.getElementById("trn_menu");
 d.style.position = "fixed";
 d.style.fontFamily = "sans";
 d.style.right = "0px";
 d.style.top = "240px";
 d.style.width = "401px";
 d.style.height = "240px";
 d.style.zIndex = "100";
 d.style.backgroundColor = "#AADDDD";
 d.style.textAlign = "right";
 d.style.fontSize = "20px";
 d.innerHTML =  "Head<hr>" +
 "<input type='button' value='Head' style='font-size:21px' onClick='javascript:sendHead(\"" + $ls + "\")'>";
 d.style.display = "";
}

function trnOfferAnother($ls) {
 var $result = sessionStorage.getItem($ls + '.result');
 var $newmark = sessionStorage.getItem($ls + '.newmark');
 var $rep = sessionStorage.getItem($ls + '.representation');
 var $tlink = sessionStorage.getItem($ls + '.tlink');

 if ($result == 200) {
  // yes yes, 200 is not the only response
  $json_o = JSON.parse($rep);
  $newmark = $json_o.csi18n_xlate_resource.newmark;
  $lang = $json_o.csi18n_xlate_resource.language;
  $trans = $json_o.csi18n_xlate_resource.translation;
  $vis = $json_o.csi18n_xlate_resource.visibility;
 } else {
  $lang = localStorage.getItem('csi18n_lang');
  if ($lang == null) {
   $lang = window.navigator.language;
  }
  $trans = '';
  $vis = '';
 }
 var isano = ($vis == 'anonymous') ? 'selected' : '';
 var ispub = ($vis == 'public') ? 'selected' : '';
 var isprv = ($vis == 'private') ? 'selected' : '';
 var isper = ($vis == 'personal') ? 'selected' : '';

 var d = document.getElementById("trn_menu");
 d.style.position = "fixed";
 d.style.fontFamily = "sans";
 d.style.right = "0px";
 d.style.top = "240px";
 d.style.zIndex = "100";
 d.style.backgroundColor = "#AADDDD";
 d.style.textAlign = "right";
 d.style.fontSize = "20px";
 d.innerHTML = "Offer another<hr>" +
 "<input type='text' value='" + escapeHtml($newmark) + "' disabled='' size='30' name='newmark_iv' id='newmark_iv' style='font-size:21px'>Newmark<br>" +
 "<input type='text' value='" + escapeHtml($lang) + "' size='30' name='cl_iv' id='cl_iv' style='font-size:21px'>Content-Language<br>" +
 "<textarea cols='20' rows='3' name='translation_iv' id='translation_iv' type='text' style='font-size:21px'>" + escapeHtml($trans) + "</textarea>Translation<br>" +
 "<select size='4' name='visibility_iv' id='visibility_iv' style='font-size:21px'>" +
 "<option value='anonymous' " + isano + ">Anonymous</option>" +
 "<option value='public' " + ispub + ">Public</option>" +
 "<option value='private' " + isprv + ">Private</option>" +
 "<option value='personal' " + isper + ">Personal</option>" +
 "</select>Visibility<br>" +
 "<input type='hidden' value='1' name='visitsid'>" +
 "<input type='hidden' value='test05' name='un'>" +
 "<input type='hidden' value='e3c12c03cf320b243977d6ac389805de' name='apikey'>" +
 "<input type='hidden' value='test' name='pw'>" +
 "<input type='button' value='Submit' style='font-size:21px' onClick='javascript:sendPost()'>";
 d.style.display = "";
}

function trnDelete($ls) {
 var $result = sessionStorage.getItem($ls + '.result');
 var $newmark = sessionStorage.getItem($ls + '.newmark');
 var $rep = sessionStorage.getItem($ls + '.representation');
 var $tlink = sessionStorage.getItem($ls + '.tlink');

 if ($result == 200) {
  // yes yes, 200 is not the only response
  $json_o = JSON.parse($rep);
  $newmark = $json_o.csi18n_xlate_resource.newmark;
  $lang = $json_o.csi18n_xlate_resource.language;
  $trans = $json_o.csi18n_xlate_resource.translation;
  $vis = $json_o.csi18n_xlate_resource.visibility;
 } else {
  $lang = localStorage.getItem('csi18n_lang');
  if ($lang == null) {
   $lang = window.navigator.language;
  }
  $trans = '';
  $vis = '';
 }
 var isano = ($vis == 'anonymous') ? 'selected' : '';
 var ispub = ($vis == 'public') ? 'selected' : '';
 var isprv = ($vis == 'private') ? 'selected' : '';
 var isper = ($vis == 'personal') ? 'selected' : '';

 var d = document.getElementById("trn_menu");
 d.style.position = "fixed";
 d.style.fontFamily = "sans";
 d.style.right = "0px";
 d.style.top = "240px";
 d.style.zIndex = "100";
 d.style.backgroundColor = "#AADDDD";
 d.style.textAlign = "right";
 d.style.fontSize = "20px";
 d.innerHTML = "Delete<hr>" +
 "<input type='text' value='" + escapeHtml($newmark) + "' disabled size='30' name='newmark_iv' id='newmark_iv' style='font-size:21px'>Newmark<br>" +
 "<input type='text' value='" + escapeHtml($lang) + "' disabled size='30' name='cl_iv' id='cl_iv' style='font-size:21px'>Content-Language<br>" +
 "<textarea disabled cols='30' rows='3' name='translation_iv' id='translation_iv' type='text' style='font-size:21px'>" + escapeHtml($trans) + "</textarea>Translation<br>" +
 "<select disabled size='4' name='visibility_iv' id='visibility_iv' style='font-size:21px'>" +
 "<option value='anonymous' " + isano + ">Anonymous</option>" +
 "<option value='public' " + ispub + ">Public</option>" +
 "<option value='private' " + isprv + ">Private</option>" +
 "<option value='personal' " + isper + ">Personal</option>" +
 "</select>Visibility<br>" +
 "<input type='hidden' value='1' name='visitsid'>" +
 "<input type='hidden' value='test05' name='un'>" +
 "<input type='hidden' value='e3c12c03cf320b243977d6ac389805de' name='apikey'>" +
 "<input type='hidden' value='test' name='pw'>" +
 "<input type='button' value='Delete' style='font-size:21px' onClick='javascript:sendDelete(\"" + $ls + "\")'>";
 d.style.display = "";
}

function trnEdit($ls) {
 var $result = sessionStorage.getItem($ls + '.result');
 var $newmark = sessionStorage.getItem($ls + '.newmark');
 var $rep = sessionStorage.getItem($ls + '.representation');
 var $tlink = sessionStorage.getItem($ls + '.tlink');

 if ($result == 200) {
  // yes yes, 200 is not the only response
  $json_o = JSON.parse($rep);
  $newmark = $json_o.csi18n_xlate_resource.newmark;
  $lang = $json_o.csi18n_xlate_resource.language;
  $trans = $json_o.csi18n_xlate_resource.translation;
  $vis = $json_o.csi18n_xlate_resource.visibility;
 } else {
  $lang = localStorage.getItem('csi18n_lang');
  if ($lang == null) {
   $lang = window.navigator.language;
  }
  $trans = '';
  $vis = '';
 }
 var isano = ($vis == 'anonymous') ? 'selected' : '';
 var ispub = ($vis == 'public') ? 'selected' : '';
 var isprv = ($vis == 'private') ? 'selected' : '';
 var isper = ($vis == 'personal') ? 'selected' : '';

 var d = document.getElementById("trn_menu");
 d.style.position = "fixed";
 d.style.fontFamily = "sans";
 d.style.right = "0px";
 d.style.top = "240px";
 d.style.zIndex = "100";
 d.style.backgroundColor = "#AADDDD";
 d.style.textAlign = "right";
 d.style.fontSize = "20px";
 d.innerHTML = "Edit<hr>" +
 "<input type='text' value='" + escapeHtml($newmark) + "' disabled='' size='30' name='newmark_iv' id='newmark_iv' style='font-size:21px'>Newmark<br>" +
 "<input type='text' value='" + escapeHtml($lang) + "' size='30' name='cl_iv' id='cl_iv' style='font-size:21px'>Content-Language<br>" +
 "<textarea cols='30' rows='3' name='translation_iv' id='translation_iv' type='text' style='font-size:21px'>" + escapeHtml($trans) + "</textarea>Translation<br>" +
 "<select size='4' name='visibility_iv' id='visibility_iv' style='font-size:21px'>" +
 "<option value='anonymous' " + isano + ">Anonymous</option>" +
 "<option value='public' " + ispub + ">Public</option>" +
 "<option value='private' " + isprv + ">Private</option>" +
 "<option value='personal' " + isper + ">Personal</option>" +
 "</select>Visibility<br>" +
 "<input type='hidden' value='1' name='visitsid'>" +
 "<input type='hidden' value='test05' name='un'>" +
 "<input type='hidden' value='e3c12c03cf320b243977d6ac389805de' name='apikey'>" +
 "<input type='hidden' value='test' name='pw'>" +
 "<input type='button' value='Submit' style='font-size:21px' onClick='javascript:sendPut(\"" + $ls + "\")'>";
 d.style.display = "";
}

///////////////////////////////////////////////////////////////////

//
// Functions for effecting the various HTTP method calls
//
// Note that these all make CORS requests in the background first, as the
// call are all Cross Origin in nature.
//
// The functions to send the request appear first; the callback handlers
// for when the server has replied appear after
// 
function sendGet($el, $newmark) {
 var url = "https://rest.mpsvr.com/newmarks/92/" + $newmark;
 if (XMLHttpRequest) {
   var request = new XMLHttpRequest();
   if("withCredentials" in request) {
    // Firefox 3.5 and Safari 4
    $lang = localStorage.getItem('csi18n_lang');
    if ($lang == null) {
     $lang = window.navigator.language;
    }
    request.open('GET', url, true);
    request.setRequestHeader("Authorization", "Basic dGVzdDA1OnRlc3Q=");
    request.setRequestHeader("X-APIKey", "e3c12c03cf320b243977d6ac389805de");
    request.setRequestHeader("Accept", "application/json");
    request.responseType = "json";
    request.setRequestHeader("Accept-Language", $lang);
    request.setRequestHeader("If-Modified-Since", "Tue,  1 Jan 1980 19:12:53 BST");
    request.setRequestHeader("If-None-Match", "Wibble");
    if ($el == 'fr0101') {
     request.onload = handler_fr0101;
    } else if ($el == 'fr0102') {
     request.onload = handler_fr0102;
    } else if ($el == 'fr0201') {
     request.onload = handler_fr0201;
    } else if ($el == 'fr0202') {
     request.onload = handler_fr0202;
    } else if ($el == 'fr0301') {
     request.onload = handler_fr0301;
    } else if ($el == 'fr0401') {
     request.onload = handler_fr0401;
    }
    request.send();
  }
 }
}

function sendHead($ls) {
 var $tlink = sessionStorage.getItem($ls + '.tlink');
 if (XMLHttpRequest) {
   var request = new XMLHttpRequest();
   if("withCredentials" in request) {
    // Firefox 3.5 and Safari 4
    $lang = localStorage.getItem('csi18n_lang');
    if ($lang == null) {
     $lang = window.navigator.language;
    }
    request.open('HEAD', $tlink, true);
    request.setRequestHeader("Authorization", "Basic dGVzdDA1OnRlc3Q=");
    request.setRequestHeader("X-APIKey", "e3c12c03cf320b243977d6ac389805de");
    request.setRequestHeader("Accept", "application/json");
    request.responseType = "json";
    request.onload = head_handler;
    request.send();
  }
 }
}

function sendOptions($ls) {
 var $tlink = sessionStorage.getItem($ls + '.tlink');
 if (XMLHttpRequest) {
   var request = new XMLHttpRequest();
   if("withCredentials" in request) {
    // Firefox 3.5 and Safari 4
    request.open('OPTIONS', $tlink, true);
    request.setRequestHeader("Authorization", "Basic dGVzdDA1OnRlc3Q=");
    request.setRequestHeader("X-APIKey", "e3c12c03cf320b243977d6ac389805de");
    request.onload = options_handler;
    request.send();
  }
 }
}

function sendPost() {
 var d = document.getElementById("newmark_iv");
 $newmark = d.value;
 d = document.getElementById("translation_iv");
 $translation = d.value;
 d = document.getElementById("cl_iv");
 $cont_lang = d.value;
 d = document.getElementById("visibility_iv");
 $vis = d.value;

 $arr = { 'csi18n_xlate_resource' : { 'language' : $cont_lang, 'translation' : $translation, 'visibility' : $vis } };
 $json_s = JSON.stringify($arr);

 var url = "https://rest.mpsvr.com/newmarks/92/" + $newmark;
 if (XMLHttpRequest) {
   var request = new XMLHttpRequest();
   if("withCredentials" in request) {
    // Firefox 3.5 and Safari 4
    request.open('POST', url, true);
    request.setRequestHeader("Authorization", "Basic dGVzdDA1OnRlc3Q=");
    request.setRequestHeader("X-APIKey", "e3c12c03cf320b243977d6ac389805de");
    request.setRequestHeader("Content-Type", "application/json;v=1.0");
    request.onload = post_handler;
    request.send($json_s);
  }
 }
}

function sendPut($ls) {
 var d = document.getElementById("newmark_iv");
 $newmark = d.value;
 d = document.getElementById("translation_iv");
 $translation = d.value;
 d = document.getElementById("cl_iv");
 $cont_lang = d.value;
 d = document.getElementById("visibility_iv");
 $vis = d.value;

 $arr = { 'csi18n_xlate_resource' : { 'language' : $cont_lang, 'translation' : $translation, 'visibility' : $vis } };
 $json_s = JSON.stringify($arr);

 var $tlink = sessionStorage.getItem($ls + '.tlink');
 if (XMLHttpRequest) {
   var request = new XMLHttpRequest();
   if("withCredentials" in request) {
    // Firefox 3.5 and Safari 4
    request.open('PUT', $tlink, true);
    request.setRequestHeader("Authorization", "Basic dGVzdDA1OnRlc3Q=");
    request.setRequestHeader("X-APIKey", "e3c12c03cf320b243977d6ac389805de");
    request.setRequestHeader("Content-Type", "application/json;v=1.0");
    request.onload = put_handler;
    request.send($json_s);
  }
 }
}

function sendDelete($ls) {
 var $tlink = sessionStorage.getItem($ls + '.tlink');
 if (XMLHttpRequest) {
   var request = new XMLHttpRequest();
   if("withCredentials" in request) {
    // Firefox 3.5 and Safari 4
    request.open('DELETE', $tlink, true);
    request.setRequestHeader("Authorization", "Basic dGVzdDA1OnRlc3Q=");
    request.setRequestHeader("X-APIKey", "e3c12c03cf320b243977d6ac389805de");
    request.setRequestHeader("If-Modified-Since", "Tue,  1 Jan 1980 19:12:53 BST");
    request.setRequestHeader("If-None-Match", "Wibble");
    request.setRequestHeader("Accept", "application/json");
    request.responseType = "json";
    request.onload = delete_handler;
    request.send();
  }
 }
}

// callback handlers
function delete_handler() {
  $status = this.status;
  var d = document.getElementById("trn_menu");
  d.style.position = "fixed";
  d.style.fontFamily = "sans";
  d.style.right = "0px";
  d.style.top = "240px";
  d.style.zIndex = "101";
  d.style.backgroundColor = "#AADDDD";
  d.style.textAlign = "right";
  d.style.fontSize = "20px";
  d.innerHTML = escapeHtml(this.statusText);
  d.style.display = "";
}

function post_handler() {
  $status = this.status;
  var d = document.getElementById("trn_menu");
  d.style.position = "fixed";
  d.style.fontFamily = "sans";
  d.style.right = "0px";
  d.style.top = "240px";
  d.style.zIndex = "101";
  d.style.backgroundColor = "#AADDDD";
  d.style.textAlign = "right";
  d.style.fontSize = "20px";
  d.innerHTML = escapeHtml(this.statusText);
  d.style.display = "";
}

function seemore_handler() {
  $status = this.status;
   var d = document.getElementById("trn_menu");
   d.style.position = "fixed";
   d.style.fontFamily = "sans";
   d.style.right = "0px";
   d.style.top = "240px";
   d.style.zIndex = "101";
   d.style.backgroundColor = "#AADDDD";
   d.style.textAlign = "right";
   d.style.fontSize = "20px";

   $json = this.response;
   sessionStorage.setItem('csi18n_seemore.representations', JSON.stringify($json));

   var $el = '';
   var $safe_choices = '';
   var $unsafe_choices = '';
   for(index = 0; index < $json.csi18n_xlate_resources.length; index++) {
    $el = $json.csi18n_xlate_resources[index];
    $unsafe_choice = $el.translation;
    $tlink = $el.url;
    $safe_choices = $safe_choices + "<li><a href='javascript:trnPreferAnother(\"" + index + "\")'>" + escapeHtml($unsafe_choice) + "</a></li>";
   }
   if ($safe_choices.length > 0) {
    $safe_choices = "<nav><ul>" + $safe_choices + "</ul></nav>";
   } 
   $safe_choices = "See more<hr>" + $safe_choices;
   d.innerHTML = $safe_choices;
   d.style.display = "";
}

function put_handler() {
  $status = this.status;
  var d = document.getElementById("trn_menu");
  d.style.position = "fixed";
  d.style.fontFamily = "sans";
  d.style.right = "0px";
  d.style.top = "240px";
  d.style.zIndex = "101";
  d.style.backgroundColor = "#AADDDD";
  d.style.textAlign = "right";
  d.style.fontSize = "20px";
  d.innerHTML = escapeHtml(this.statusText);
  d.style.display = "";
}

function preferanother_handler() {
  $status = this.status;
  var d = document.getElementById("trn_menu");
  d.style.position = "fixed";
  d.style.fontFamily = "sans";
  d.style.right = "0px";
  d.style.top = "240px";
  d.style.zIndex = "101";
  d.style.backgroundColor = "#AADDDD";
  d.style.textAlign = "right";
  d.style.fontSize = "20px";
  d.innerHTML = escapeHtml(this.statusText);
  d.style.display = "";
}

function handler_fr0101() {
  var d = document.getElementById("fr0101");
  $status = this.status;
  if ($status == 200) {
   $json_o = this.response;
   $translation = $json_o.csi18n_xlate_resource.translation;
   var currently = localStorage.getItem('csi18n_onOrOff');
   if (currently != "off") {
    d.firstChild.innerHTML = escapeHtml($translation);
   } else {
    d.innerHTML = escapeHtml($translation);
   }
   sessionStorage.setItem('csi18n_fr0101.representation', JSON.stringify($json_o));
   sessionStorage.setItem('csi18n_fr0101.result', $status);
   sessionStorage.setItem('csi18n_fr0101.tlink', this.getResponseHeader('Content-Location'));
   d.style.display = "";
  } 
}

function handler_fr0102() {
  var d = document.getElementById("fr0102");
  $status = this.status;
  if ($status == 200) {
   $json_o = this.response;
   $translation = $json_o.csi18n_xlate_resource.translation;
   var currently = localStorage.getItem('csi18n_onOrOff');
   if (currently == "on") {
    d.firstChild.innerHTML = escapeHtml($translation);
   } else {
    d.innerHTML = escapeHtml($translation);
   }
   sessionStorage.setItem('csi18n_fr0102.representation', JSON.stringify($json_o));
   sessionStorage.setItem('csi18n_fr0102.result', $status); 
   sessionStorage.setItem('csi18n_fr0102.tlink', this.getResponseHeader('Content-Location'));
   d.style.display = "";
  } 
}

function handler_fr0201() {
  var d = document.getElementById("fr0201");
  $status = this.status;
  if ($status == 200) {
   $json_o = this.response;
   $translation = $json_o.csi18n_xlate_resource.translation;
   var currently = localStorage.getItem('csi18n_onOrOff');
   if (currently == "on") {
    d.firstChild.innerHTML = escapeHtml($translation);
   } else {
    d.innerHTML = escapeHtml($translation);
   }
   sessionStorage.setItem('csi18n_fr0201.representation', JSON.stringify($json_o));
   sessionStorage.setItem('csi18n_fr0201.result', $status); 
   sessionStorage.setItem('csi18n_fr0201.tlink', this.getResponseHeader('Content-Location'));
   d.style.display = "";
  } 
}

function handler_fr0202() {
  var d = document.getElementById("fr0202");
  $status = this.status;
  if ($status == 200) {
   $json_o = this.response;
   $translation = $json_o.csi18n_xlate_resource.translation;
   var currently = localStorage.getItem('csi18n_onOrOff');
   if (currently == "on") {
    d.firstChild.innerHTML = escapeHtml($translation);
   } else {
    d.innerHTML = escapeHtml($translation);
   }
   sessionStorage.setItem('csi18n_fr0202.representation', JSON.stringify($json_o));
   sessionStorage.setItem('csi18n_fr0202.result', $status); 
   sessionStorage.setItem('csi18n_fr0202.tlink', this.getResponseHeader('Content-Location'));
   d.style.display = "";
  } 
}

function handler_fr0301() {
  var d = document.getElementById("fr0301");
  $status = this.status;
  if ($status == 200) {
   $json_o = this.response;
   $translation = $json_o.csi18n_xlate_resource.translation;
   var currently = localStorage.getItem('csi18n_onOrOff');
   if (currently == "on") {
    d.firstChild.innerHTML = escapeHtml($translation);
   } else {
    d.innerHTML = escapeHtml($translation);
   }
   sessionStorage.setItem('csi18n_fr0301.representation', JSON.stringify($json_o));
   sessionStorage.setItem('csi18n_fr0301.result', $status); 
   sessionStorage.setItem('csi18n_fr0301.tlink', this.getResponseHeader('Content-Location'));
   d.style.display = "";
  } 
}

function handler_fr0401() {
  var d = document.getElementById("fr0401");
  $status = this.status;
  if ($status == 200) {
   $json_o = this.response;
   $translation = $json_o.csi18n_xlate_resource.translation;
   var currently = localStorage.getItem('csi18n_onOrOff');
   if (currently == "on") {
    d.firstChild.innerHTML = escapeHtml($translation);
   } else {
    d.innerHTML = escapeHtml($translation);
   }
   sessionStorage.setItem('csi18n_fr0401.representation', JSON.stringify($json_o));
   sessionStorage.setItem('csi18n_fr0401.result', $status); 
   sessionStorage.setItem('csi18n_fr0401.tlink', this.getResponseHeader('Content-Location'));
   d.style.display = "none";
  } 
}

function options_handler() {
  $status = this.status;
  var d = document.getElementById("trn_menu");
  d.style.position = "fixed";
  d.style.fontFamily = "sans";
  d.style.right = "0px";
  d.style.top = "240px";
  d.style.zIndex = "101";
  d.style.backgroundColor = "#AADDDD";
  d.style.textAlign = "right";
  d.style.fontSize = "20px";
  d.innerHTML = escapeHtml(this.statusText) + "<br>" + escapeHtml(this.responseText);
  d.style.display = "";
}

function head_handler() {
  $status = this.status;
  var d = document.getElementById("trn_menu");
  d.style.position = "fixed";
  d.style.fontFamily = "sans";
  d.style.right = "0px";
  d.style.top = "240px";
  d.style.zIndex = "101";
  d.style.backgroundColor = "#AADDDD";
  d.style.textAlign = "right";
  d.style.fontSize = "20px";
  d.innerHTML = escapeHtml(this.statusText) + "<br>" + escapeHtml(this.responseText);
  d.style.display = "";
}

///////////////////////////////////////////////////////////////////

//
// Service menu and handlers: hyperlinks, credentials and language
// toggleShowServiceMenu effected by single-click on Globe
//
function toggleShowServiceMenu() {
 var d = document.getElementById("svc_menu");
 if (d.style.display == "") {
  d.style.display = "none";
 } else {
  d.style.position = "fixed";
  d.style.fontFamily = "sans";
  d.style.right = "0px";
  d.style.top = "100px";
  d.style.width = "33%";
  d.style.zIndex = "100";
  d.style.backgroundColor = "#AADDDD";
  d.style.textAlign = "right";
  d.style.fontSize = "20px";
  d.innerHTML = "<a href='javascript:toggleShowHyperlinks()'>hyperlinks on/off<a><br> " +
 "<a href='javascript:acceptUsername()'>username</a><br>" +
 "<a href='javascript:acceptPassword()'>password</a><br>" +
 "<a href='javascript:acceptApikey()'>apikey</a><br>" +
 "<a href='javascript:acceptDefLang()'>Default Language</a><br>";
  d.style.display = "";
 }
}

// Translation menu effected by click text in the speech bubbles while 
// hyperlinks on
// 
function toggleShowTranslationMenu($ls) {
 var d = document.getElementById("trn_menu");

 $res = sessionStorage.getItem($ls + '.representation');
 if ($res != '') {
  $seemore_uri = $res.csi18n_per_lang_preference;
 } else {
  $seemore_uri = '';
 }
 sessionStorage.setItem('csi18n_seemore.per_lang_pref', $seemore_uri);
	
 if (d.style.display == "") {
  d.style.display = "none";
 } else {
  d.style.position = "fixed";
  d.style.fontFamily = "sans";
  d.style.right = "0px";
  d.style.top = "240px";
  d.style.zIndex = "100";
  d.style.backgroundColor = "#AADDDD";
  d.style.textAlign = "right";
  d.style.fontSize = "20px";
  d.style.height = "";
  d.style.width = "33%";
  d.innerHTML = "<a href='javascript:trnSeeMore(\"" + $ls + "\")'>See more</a><br>" +
 "<a href='javascript:trnOfferAnother(\"" + $ls + "\")'>Offer another</a><br>" +
 "<a href='javascript:trnEdit(\"" + $ls + "\")'>- Edit</a><br>" +
 "<a href='javascript:trnDelete(\"" + $ls + "\")'>- Delete</a><br>" +
 "<a href='javascript:trnOptions(\"" + $ls + "\")'>- Options</a><br>" +
 "<a href='javascript:trnHead(\"" + $ls + "\")'>- Head</a><br>" +
 "<a href='http://csi18n.mpsvr.com/index.php/Storyboard_03'>- Bump</a><br>" +
 "<a href='http://csi18n.mpsvr.com/index.php/Storyboard_03'>- UnBump</a><br>" +
 "<a href='http://csi18n.mpsvr.com/index.php/Storyboard_01'>- Lock</a><br>" +
 "<a href='http://csi18n.mpsvr.com/index.php/Storyboard_01'>- Unlock</a><br>" + 
 "<a href='http://csi18n.mpsvr.com/index.php/Storyboard_01'>- History</a><br>";
  d.style.display = "";
 }
}

function toggleShowHyperlinks() {
 var currently = localStorage.getItem('csi18n_onOrOff');
 if (currently != "off") {
  localStorage.setItem('csi18n_onOrOff','off');
 } else {
  localStorage.setItem('csi18n_onOrOff','on');
 }
}

///////////////////////////////////////////////////////////////////

function acceptUsername() {
 $username = localStorage.getItem('csi18n_un');
 var rv = prompt("Username", $username);
 if (rv != null) {
  localStorage.setItem('csi18n_un', rv);
 }
}

function acceptPassword() {
 $password = localStorage.getItem('csi18n_pw');
 var rv = prompt("Password", $password);
 if (rv != null) {
  localStorage.setItem('csi18n_pw', rv);
 }
}

function acceptApikey() {
 $apikey = localStorage.getItem('csi18n_key');
 var rv = prompt("APIKey", $apikey);
 if (rv != null) {
  localStorage.setItem('csi18n_key', rv);
 }
}

function acceptDefLang() {
 $deflang = localStorage.getItem('csi18n_lang');
 if ($deflang == null) {
  $deflang = window.navigator.language;
 }
 var rv = prompt("New Language", $deflang);
 if (rv != null) {
  localStorage.setItem('csi18n_lang', rv);
 }
}

///////////////////////////////////////////////////////////////////

//
// JS for creating the bubble on page (or hiding it)
//
function createDialog($el, $corner, $totx, $toty, $posx, $posy, $size, $maxwidth, $style, $newmark) {
 var d = document.getElementById($el);
 d.style.display = "none";
 d.style.left = "auto";
 d.style.right = "auto";
 d.style.top = "auto";
 d.style.bottom = "auto";

 if ($el === 'fr0101') {
  sessionStorage.setItem('csi18n_fr0101.result', 0);
  sessionStorage.setItem('csi18n_fr0101.newmark', $newmark);
  sessionStorage.setItem('csi18n_fr0101.representation', '');
  sessionStorage.setItem('csi18n_fr0101.tlink', '');
 } else if ($el === 'fr0102') {
  sessionStorage.setItem('csi18n_fr0102.result', 0);
  sessionStorage.setItem('csi18n_fr0102.newmark', $newmark);
  sessionStorage.setItem('csi18n_fr0102.representation', '');
  sessionStorage.setItem('csi18n_fr0102.tlink', '');
 } else if ($el === 'fr0201') {
  sessionStorage.setItem('csi18n_fr0201.result', 0);
  sessionStorage.setItem('csi18n_fr0201.newmark', $newmark);
  sessionStorage.setItem('csi18n_fr0201.representation', '');
  sessionStorage.setItem('csi18n_fr0201.tlink', '');
 } else if ($el === 'fr0202') {
  sessionStorage.setItem('csi18n_fr0202.result', 0);
  sessionStorage.setItem('csi18n_fr0202.newmark', $newmark);
  sessionStorage.setItem('csi18n_fr0202.representation', '');
  sessionStorage.setItem('csi18n_fr0202.tlink', '');
 } else if ($el === 'fr0301') {
  sessionStorage.setItem('csi18n_fr0301.result', 0);
  sessionStorage.setItem('csi18n_fr0301.newmark', $newmark);
  sessionStorage.setItem('csi18n_fr0301.representation', '');
  sessionStorage.setItem('csi18n_fr0301.tlink', '');
 } else if ($el === 'fr0401') {
  sessionStorage.setItem('csi18n_fr0401.result', 0);
  sessionStorage.setItem('csi18n_fr0401.newmark', $newmark);
  sessionStorage.setItem('csi18n_fr0401.representation', '');
  sessionStorage.setItem('csi18n_fr0401.tlink', '');
 } 

 if ($corner != 'hide') {
  $rv = sendGet($el, $newmark);
  if (typeof $rv === 'undefined') {
   $translation = 'undefined';
  } else {
   $translation = $rv;
  }
 }

 if (localStorage.getItem('csi18n_onOrOff') == 'on') {
  if ($el === 'fr0101') {
   d.innerHTML = "<a href='javascript:toggleShowTranslationMenu(\"csi18n_fr0101\")'>" + escapeHtml($translation) + "</a>"; 
  } else if ($el === 'fr0102') {
   d.innerHTML = "<a href='javascript:toggleShowTranslationMenu(\"csi18n_fr0102\")'>" + escapeHtml($translation) + "</a>"; 
  } else if ($el === 'fr0201') {
   d.innerHTML = "<a href='javascript:toggleShowTranslationMenu(\"csi18n_fr0201\")'>" + escapeHtml($translation) + "</a>"; 
  } else if ($el === 'fr0202') {
   d.innerHTML = "<a href='javascript:toggleShowTranslationMenu(\"csi18n_fr0202\")'>" + escapeHtml($translation) + "</a>"; 
  } else if ($el === 'fr0301') {
   d.innerHTML = "<a href='javascript:toggleShowTranslationMenu(\"csi18n_fr0301\")'>" + escapeHtml($translation) + "</a>"; 
  } else if ($el === 'fr0401') {
   d.innerHTML = "<a href='javascript:toggleShowTranslationMenu(\"csi18n_fr0401\")'>" + escapeHtml($translation) + "</a>"; 
  }
 } else {
  d.innerHTML = escapeHtml($translation);
 }

 if ($corner == 'BR') {
  d.style.position = "absolute";
  d.style.right = ($totx - $posx) + "px";
  d.style.bottom = ($toty - $posy) + "px";
  d.style.zIndex = "100";
  d.style.backgroundColor = "#DDDDDD";
  d.style.textAlign = "right";

 } else if ($corner == 'TR') {
  d.style.position = "absolute";
  d.style.right = ($totx - $posx) + "px";
  d.style.top = $posy + "px";
  d.style.fontSize = "20px";
  d.style.zIndex = "100";
  d.style.backgroundColor = "#FFFFFF";
  d.style.textAlign = "right";

 } else if ($corner == 'BL') {
  d.style.position = "absolute";
  d.style.left = $posx + "px";;
  d.style.bottom = ($toty - $posy) + "px";
  d.style.fontSize = "20px";
  d.style.zIndex = "100";
  d.style.backgroundColor = "#DDDDDD";
  d.style.textAlign = "left";

 } else if ($corner == 'TL') {
  d.style.position = "absolute";
  d.style.left = $posx + "px";
  d.style.top = $posy + "px";
  d.style.fontSize = "20px";
  d.style.zIndex = "100";
  d.style.backgroundColor = "#FFFFFF";
  d.style.textAlign = "left";
 }

 if ($corner != "hide") {
  d.style.display = "";
  d.style.fontSize = $size + "px";
  d.style.fontFamily = "sans";
  d.style.fontStyle = $style;
  if ($maxwidth != "0") {
   d.style.maxWidth = $maxwidth + "px";
  } else {
   d.style.maxWidth = "";
  }
 }
}

///////////////////////////////////////////////////////////////////

//
//
// $el, $corner, $totx, $toty, $posx, $posy, $size, $maxwidth, $style, $newmark
function xkcdShow() {
 createDialog("fr0101", "BR", 1536, 8192, 205, 56, "12", "201", "", "xkcd-jurassic-world-fr0101");
 createDialog("fr0102", "TL", 1536, 8192, 42, 64, "12", "161", "", "xkcd-jurassic-world-fr0102");
 createDialog("fr0201", "BR", 1536, 8192, 388, 46, "12", "169", "", "xkcd-jurassic-world-fr0201");
 createDialog("fr0202", "TL", 1536, 8192, 255, 50, "12", "134", "", "xkcd-jurassic-world-fr0202");
 createDialog("fr0301", "BR", 1536, 8192, 558, 117, "12", "159", "", "xkcd-jurassic-world-fr0301");
 createDialog("fr0401", "BR", 1536, 8192, 731, 72, "12", "157", "", "xkcd-jurassic-world-fr0401");
}

function xkcdShowLines() {
 DrawLine(33, 150, 30, 70);
 DrawLine(110, 184, 136, 150);
 DrawLine(268, 150, 248, 46);
 DrawLine(342, 160, 356, 94);
 DrawLine(470, 163, 476, 122);
}

//
// madox2 @ http://stackoverflow.com/questions/4270485/drawing-lines-on-html-page
function DrawLine(x1, y1, x2, y2){

    if(y1 < y2){
        var pom = y1;
        y1 = y2;
        y2 = pom;
        pom = x1;
        x1 = x2;
        x2 = pom;
    }

    var a = Math.abs(x1-x2);
    var b = Math.abs(y1-y2);
    var c;
    var sx = (x1+x2)/2 ;
    var sy = (y1+y2)/2 ;
    var width = Math.sqrt(a*a + b*b ) ;
    var x = sx - width/2;
    var y = sy;

    a = width / 2;

    c = Math.abs(sx-x);

    b = Math.sqrt(Math.abs(x1-x)*Math.abs(x1-x)+Math.abs(y1-y)*Math.abs(y1-y) );

    var cosb = (b*b - a*a - c*c) / (2*a*c);
    var rad = Math.acos(cosb);
    var deg = (rad*180)/Math.PI

    htmlns = "http://www.w3.org/1999/xhtml";
    div = document.createElementNS(htmlns, "div");
    div.setAttribute('style','border:1px solid black;width:'+width+'px;height:0px;-moz-transform:rotate('+deg+'deg);-webkit-transform:rotate('+deg+'deg);position:absolute;top:'+y+'px;left:'+x+'px;');   

    document.getElementById("tochterAusElysium").appendChild(div);
}

function showWhatWasImgTitle(){
  var d = document.getElementById("fr0401");
  d.style.display = "";
}

function hideWhatWasImgTitle(){
  var d = document.getElementById("fr0401");
  d.style.display = "none";
}

///////////////////////////////////////////////////////////////////

// XSS. Storing:
//   hello</a><img src=bogus onerror=alert(1337)><a href="">
// is an XSS vuln: sanitise text before use. In practice, I only seem to 
// use .innerHtml for use so either .innerHtml = escapeHtml(unsafe) or
// name vars as safe/unsafe and only assign a safe to .innerHtml
//
// bjornd @ http://stackoverflow.com/questions/6234773/can-i-escape-html-special-chars-in-javascript
function escapeHtml(unsafe) {
    return unsafe
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;");
}
//" <-- emacs discolours below unless I terminate the stroke-quote-stroke above

//
// Setup when never been here before. Preload with credents and use non-localised English
// 
function onLoad() {
 sessionStorage.clear();
 var currently = localStorage.getItem('csi18n_onOrOff');
 if (currently != "on" && currently != "off") {
  localStorage.setItem('csi18n_onOrOff', "on");
  localStorage.setItem('csi18n_un', "test05");
  localStorage.setItem('csi18n_pw', "test");
  localStorage.setItem('csi18n_key', "e3c12c03cf320b243977d6ac389805de");
  localStorage.setItem('csi18n_lang', "en")  
  localStorage.setItem('csi18n_seemore.representations', '');
  localStorage.setItem('csi18n_seemore.per_lang_pref', '');
 }
 xkcdShow();
 hideWhatWasImgTitle();
 xkcdShowLines();
}
</script>
</head>

<!--
///////////////////////////////////////////////////////////////////
-->

<body onload='javascript:onLoad()'>
<div id="tochterAusElysium" style="position: absolute; background: #BBBBBB; font-size:10px; width:1536px; height:8192px; font-family:sans;">
<img src="xkcd-notext-jurassic_world.png" alt="" usemap="#TupacVsThomasTheTankEngine" /><br>
Original work: <a href="http://xkcd.com/1452/">http://xkcd.com/1452/</a><br>
[ <a href="../20141119">prev</a> | <a href="../">up</a> | <a href="../20141201">next</a> ]<br>


<div id="globe" class= "" style="position:fixed; right:0; top: 0;"><img onclick="javascript:toggleShowServiceMenu()" src='../translationglobe.png'></div>
<div id="fr0101" class="" style="display:none" >IN JURASSIC WORLD, WE'VE USED GENETIC ENGINEERING TO INVENT A BETTER DINOSAUR.</div>
<div id="fr0102" class="" style="display:none" >TYRANNOSAUR IS THE MOST CHARISMATIC ANIMAL THAT EVER LIVED, AND YOU'LL THINK YOU'LL UPSTAGE IT?</div>
<div id="fr0201" class="" style="display:none" >TYRANNOSAUR WAS COOL, BUT IT'S TWO DECADES OLD!</div>
<div id="fr0202" class="" style="display:none" >I THINK IT'S A LITTLER OLDER THAN THAT.</div>
<div id="fr0301" class="" style="display:none" >WE TOOK TYRANNOSAURUS AND WE IMPROVED IT. MADE IT SCARIER, DEADLIER, SMARTER. LOOK - THERE IT IS!</div>

<!-- The 'Hey guys!' text is meant to appear as the <img> title. In the original, this causes the
text to appear only when hovering over the image. To my knowledge, it's not possible to click on
such text: while onLoad /could/ obtain the translation and insert it into place, it couldn't 
then be selected for replacement by the service.
Rather than rework the UI to make the text selectable without clickin on it, Imma gonna cheat 
here. Imma gonna make the the T-Rex clickable, and THAT makes the text appear. Once appeared,
the text can be edited like the rest -->
<div id="fr0401" class="" style="display:none" >Hey guys! What's eating you? Ha ha ha it's me! Oh, what fun we have.</div>

<div id="svc_menu" class="" style="display:none" ><a href="http://www.youtube.com/watch?v=CiGPTL8bnC4">Sandy White</a></div>
<div id="trn_menu" class="" style="display:none" ><a href="http://www.gutenberg.org/cache/epub/74/pg74.txt">Mark Twain</a></div>

<!--
///////////////////////////////////////////////////////////////////
-->

<map name="TupacVsThomasTheTankEngine">
  <!-- area poly generated at http://www.image-maps.com/ -->
  <area  alt="" title="" shape="poly" coords="634,263,631,232,636,212,597,183,594,163,600,137,594,113,606,95,610,100,603,115,613,139,612,160,622,167,638,164,648,154,665,112,667,93,682,80,698,77,724,88,723,104,714,105,701,102,700,108,709,121,713,136,704,136,696,143,697,180,689,200,688,206,695,233,693,258" style="outline:2px;" onMouseOver="showWhatWasImgTitle()"/>
</map>

<br>
XKCD example page from 2014-nov-27<br>
<br>
<br>
<br>
1. Visit https://xkcd.com/<br>
2. Make note of title<br>
3. Right-click image | save image as | xkcd-orig-(title).png | save<br>
4. Open GIMP<br>
5. File | open |  xkcd-orig-(title).png | open<br>
6. file | save as | xkcd-orig-(title).xcf | save<br>
7. print the image<br>
1. title the image<br>
2. label the textual elements (“xkcd-(title)-fr01-04” etc)<br>
3. label point elements (“speech line”)<br>
8. Co-ords:<br>
8.1. For each textual element<br>
8.1.1. determine where the co-ords should go (just tl, tr, bl, br for now)<br>
8.1.2. determine max width of bubble<br>
8.2. Get pixel co-ords for textual element and point elements<br>
9. Erase all textual and speech bubble elements<br>
10. File | save as | xkcd-notext-(title).xcf<br>
11. File | export … | export | export<br>
12. Close gimp<br>
13. Upload image to website<br>
13.1. Make new dir for page<br>
13.2  Upload png to it<br>
14. Edit page<br>
14.1. cd ~/csi18n/xkcd/yyyymmdd/<br>
14.2. cp ../20141119/xkcd.html .  (or whichever is most recent version)<br>
14.3. Edit xkcd.html<br>
14.1.1. IMG SRC to uploaded image<br>
14.1.2. Change attribution<br>
14.1.3. Change date at bottom<br>
14.1.4. change code to handle particular number of elements<br>
14.1.4.1. handler_X()<br>
14.1.4.2. if ($el == 'X'<br>
14.1.4.3. localstorage.setItem<br>
14.1.4.4. d.innerHTMLs<br>
14.1.4.5. xkcdShow()<br>
14.1.4.6. &lt;div id=&quot;X<br>
14.1.5. Change titles from previous to new<br>
14.1.5.1. red-rover → jurassic-world<br>
14.1.6. Change display:none to original text<br>
14.1.7. Change xkcdShow() toriginal txtEls to match original cartoon's text <br>
14.1.8. Change xkcdShow() for BT, TL etc, co-ords and widths<br>
14.1.9. Change xkcdShowLines() for speech lines<br>
14.1.10. Reworked for hiding image title speech<br>
14.1.11. Added English text as available translation<br>
<br>
Next time<br> 
1. query string in visitsid and lang<br>
</div>
</body>
</html>
